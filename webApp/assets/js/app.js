"use strict";angular.module("app",[]),angular.module("app",["ngRoute"]);var baseUrl="http://localhost:8080/",app=angular.module("app");app.directive("fileModel",["$parse",function(t){return{restrict:"A",link:function(e,n,o){var r=t(o.fileModel),a=r.assign;n.bind("change",function(){e.$apply(function(){a(e,n[0].files[0])})})}}}]),app.service("insertDB",["$http",function(t){var e=this;e.uploadFileToUrl=function(e,n){var o=new FormData;return o.append("file",e),t.post(n,o,{transformRequest:angular.identity,headers:{"Content-Type":void 0}}).then(function(t){return{status:200,result:{fileInfo:t.data}}},function(t){return{status:401}})},e.insert=function(e,n,o){var r="/img/product-image/"+o;return t.post("/api/products/",{productName:e,category:n,imageLocation:r}).then(function(){return{status:200,result:{location:r}}},function(t){return{status:404}})}}]),app.controller("addProductCtrl",["$scope","insertDB",function(t,e){t.insert=function(n,o){var r=t.pdctImg,a="/api/products/uploadPImg";e.uploadFileToUrl(r,a).then(function(t){200===t.status&&e.insert(n,o,t.result.fileInfo.filename)})}}]),function(){function t(t,e){var n=function(t){e.sessionStorage.token=t},o=function(){return e.sessionStorage.token},r=function(){e.sessionStorage.removeItem("token")},a=function(){var t=o();return t};return{saveToken:n,getToken:o,logout:r,isLoggedIn:a}}var e=angular.module("app");e.service("authentication",t),t.$inject=["$http","$window"]}();var app=angular.module("app");app.controller("loginCtrl",["$scope","userSvc","$location","authentication",function(t,e,n,o){t.message="",o.isLoggedIn()&&n.path("/profile"),t.login=function(r,a){e.login(r,a).then(function(e){401===e.status?(t.message="*Invalid username or password!",t.username="",t.password=""):(o.saveToken(e.result.token),n.path("/profile"))})}}]);var app=angular.module("app");app.controller("profileController",["$scope","userSvc","authentication","$location",function(t,e,n,o){var r=window.sessionStorage.token;e.getUser(r).then(function(e){t.username=e.data.name}),t.logout=function(){n.logout(),o.path("/login")}}]),function(){var t=angular.module("app");t.controller("registrationController",["$scope","userSvc",function(t,e){function n(e){return e.mobileNo&&10===e.mobileNo.length&&e.name&&t.password}t.register=function(){var o={name:t.name,userId:t.email,mobileNo:t.mobileno,password:t.password};n(o)?e.register(o).then(function(e){t.message="Registration Succesful"}):t.message="Invalid data"}}])}(),function(){function t(t,e){t.when("/",{templateUrl:"dashboard.html"}).when("/register",{templateUrl:"register.html"}).when("/login",{controller:"loginCtrl",templateUrl:"login.html"}).when("/profile",{templateUrl:"profile.html",controller:"profileController"}).when("/profile/adduser",{templateUrl:"adduser.html",controller:"registrationController"}).when("/addproduct",{templateUrl:"addproduct.html",controller:"addProductCtrl"})}function e(t,e,n){t.$on("$routeChangeStart",function(t,o,r){/\/profile|\//g.test(e.path())&&!n.isLoggedIn()&&e.path("/login")})}var n=angular.module("app");n.config(["$routeProvider","$locationProvider",t]).run(["$rootScope","$location","authentication",e])}(),angular.module("app").service("userSvc",["$http","authentication",function(t,e){var n=this;n.getUser=function(e){return t.get("/api/users/get",{headers:{"X-Auth":e}}).then(function(t){return t})},n.login=function(e,o){return t.post("/api/sessions/login",{userId:e,password:o}).then(function(t){return n.token=t.data,{status:200,result:{token:n.token}}},function(t){return{status:401}})},n.register=function(n){return t({method:"POST",url:"/api/users/add",headers:{"X-Auth":e.getToken()},data:n}).then(function(t){return t.data.status})}}]);